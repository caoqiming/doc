# MySQL 事务隔离级别

事务具有原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability）四个特性，简称 ACID，缺一不可。这里讲的是隔离性。

## 概念说明

1. **脏读**
   脏读指的是读到了其他事务未提交的数据，未提交意味着这些数据可能会回滚，也就是可能最终不会存到数据库中，也就是不存在的数据。读到了并一定最终存在的数据，这就是脏读。

2. **可重复读**
   可重复读指的是在一个事务内，最开始读到的数据和事务结束前的任意时刻读到的同一批数据都是一致的。通常针对数据更新（UPDATE）操作。

3. **不可重复读**
   对比可重复读，不可重复读指的是在同一事务内，不同的时刻读到的同一批数据可能是不一样的，可能会受到其他事务的影响，比如其他事务改了这批数据并提交了。通常针对数据更新（UPDATE）操作。

4. **幻读**
   幻读是针对数据插入（INSERT）操作来说的。假设事务 A 对某些行的内容作了更改，但是还未提交，此时事务 B 插入了与事务 A 更改前的记录相同的记录行，并且在事务 A 提交之前先提交了，而这时，在事务 A 中查询，会发现好像刚刚的更改对于某些数据未起作用，但其实是事务 B 刚插入进来的，让用户感觉很魔幻，感觉出现了幻觉，这就叫幻读。

## 事务隔离级别

SQL 标准定义了四种隔离级别，MySQL 全都支持。这四种隔离级别分别是：

1. **读未提交**（READ UNCOMMITTED）
2. **读提交** （READ COMMITTED）
3. **可重复读** （REPEATABLE READ）
4. **串行化** （SERIALIZABLE）

|          | 脏读 | 不可重复读 | 幻读 |
| :------: | :--: | :--------: | :--: |
| 读未提交 |      |            |      |
|  读提交  |  ❌  |            |      |
| 可重复读 |  ❌  |     ❌     |      |
|  串行化  |  ❌  |     ❌     |  ❌  |

InnoDB 的默认隔离级别是可重复读（REPEATABLE READ）
事务的执行过程，以 begin 或者 start transaction 开始，然后执行一系列操作，最后要执行 commit 或 rollback 操作，事务才算结束。需要注意的是，begin 命令并不代表事务的开始，事务开始于 begin 命令之后的第一条语句执行的时候。

### 读未提交

### 读提交（READ COMMITTED）

## 相关命令

```SQL
--查看当前数据库隔离级别
SELECT @@tx_isolation
show variables like 'tx_isolation'
--设置数据库隔离级别
set global transaction isolation level read committed;
--查询当前有多少事务正在运行
select * from information_schema.innodb_trx;

```
