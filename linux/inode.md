# inode

inode (index node) 是指在许多“类 Unix 文件系统”中的一种数据结构，用于描述文件系统对象（包括文件、目录、设备文件、socket、管道等）。每个 inode 保存了文件系统对象数据的属性和磁盘块位置。文件系统对象属性包含了各种元数据（如：最后修改时间） ，也包含用户组（owner）和权限数据。

文件系统创建（格式化）时，就把存储区域分为两大连续的存储区域。一个用来保存文件系统对象的元信息数据，这是由 inode 组成的表，每个 inode 默认是 256 字节或者 128 字节。另一个用来保存“文件系统对象”的内容数据，划分为 512 字节的扇区，以及由 8 个扇区组成的 4K 字节的块。块是读写时的基本单位。一个文件系统的 inode 的总数一般情况下是固定的。这限制了该文件系统所能存储的文件系统对象的总数目。典型的实现下，所有 inode 占用了文件系统 1%左右的存储容量。

- inode 不包含文件名或目录名的字符串，只包含文件或目录的“元信息”。
- Unix 的文件系统的目录也是一种文件。打开目录，实际上就是读取“目录文件”。目录文件的结构是一系列目录项（dirent）的列表。每个目录项，由两部分组成：所包含文件或目录的名字，以及该文件或目录名对应的 inode 号码。
- 通过文件名打开文件，实际上是分成三步实现：首先，操作系统找到这个文件名对应的 inode 号码；其次，通过 inode 号码，获取 inode 信息；最后，根据 inode 信息，找到文件数据所在的 block，读出数据。
- 一个文件或目录在文件系统内部移动时，其 inode 号码不变。文件系统碎片整理可能会改变一个文件的物理存储位置，但其 inode 号码不变。非 UNIX 的 FAT 及其派生的文件系统是无法实现 inode 不变这一特点。
- inode 文件系统中安装新库十分容易。当一些进程正在使用一个库时，其它进程可以替换该库文件名字的 inode 号码指向新创建的 inode，随后对该库的访问都被自动引导到新 inode 所指向的新的库文件的内容。这减少了替换库时重启系统的需要。而旧的 inode 的链接数已经为 0，在使用旧库的进程结束后，旧的 inode 与旧库文件会被系统自动回收。
- 一些文件系统，由于 inode 表在文件系统创建时就已经确定并且不能再动态增加，新增的文件数量可能会用尽 inode。这导致文件系统还有空闲的存储空间，但已经没有空闲的 inode 可供使用了。例如，一个电子邮件服务器可能会被大量的小文件用尽所有 inode，但是却没有填满文件存储空间。部分文件系统，如 JFS 和 XFS，能够动态地增加 inode，因此不会用尽 inode。
